<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8" />
<meta name="_csrf" th:content="${_csrf.token}" />
<meta name="_csrf_header" th:content="${_csrf.headerName}" />

<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Gundam Shop</title>
<link rel="stylesheet" href="/css/style.css" />

<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>


</head>
<body>
	<!-- menu -->
	<div class="body-nav" id="main-nav">
		<nav id="navbar">
			<div class="nav-logo">
				<div class="stripe blue"></div>
				<div class="stripe yellow"></div>
				<div class="stripe red"></div>

				<div class="logo-wrapper">
					<img src="/img/processed_no_white.png" alt="" />
					<div class="logo-title">Gundam Shop</div>
				</div>
			</div>

			<div class="nav-toolbar">
				<form action="/product" method="get" class="search">
					<div class="search-left">
						<input type="text" name="keyword" th:value="${tuKhoa}"
							placeholder="T·ª´ kh√≥a..." onfocus="this.placeholder=''"
							onblur="this.placeholder='T·ª´ kh√≥a...'" />
					</div>
					<div class="search-right">
						<button type="submit" class="in">
							<img src="/img/search.png" alt="T√¨m ki·∫øm" />
						</button>
					</div>
				</form>

				<div class="item">
					<ul>
						<li><a th:href="@{/home}">Trang ch·ªß</a></li>
						<li><a th:href="@{/product}">S·∫£n ph·∫©m</a></li>
						<li><a th:href="@{/product(
						    giamGia=true)}">H√†ng
								gi·∫£m gi√°</a></li>
						<li><a th:href="@{/product(loai='D·ª•ng c·ª•')}">D·ª•ng c·ª•</a></li>
						<li><a th:href="@{/product(loai='Ph·ª• ki·ªán')}">Ph·ª• ki·ªán</a></li>
						<li><a th:href="@{/ChinhSach}">Ch√≠nh S√°ch</a></li>
					</ul>
				</div>
			</div>

			<div class="nav-account">
				<div class="account-left">
					<label for="">K·∫øt n·ªëi</label> <a href=""><img
						src="/img/facebook.png" alt="" /></a> <a href=""><img
						src="/img/instagram.png" alt="" /></a>
				</div>
				<div class="account-right">
					<th:block th:if="${session.user != null}">
						<div class="account-container">
							<!-- Avatar c√≥ th·ªÉ click ƒë∆∞·ª£c -->
							<a th:href="@{/TrangCaNhan}" class="anh"> <img
								id="avatar-img" th:src="${session.user.avatar}" alt="Avatar"
								onerror="this.onerror=null; this.src='/img/Screenshot_2025-06-19_220523-removebg-preview.png';">
							</a>
				
							<!-- Dropdown xu·∫•t hi·ªán khi hover to√†n kh·ªëi account-container -->
							<div class="account-dropdown">
								<a th:href="@{/TrangCaNhan}">T√†i Kho·∫£n C·ªßa T√¥i</a> <a
									th:href="@{/logout}">ƒêƒÉng Xu·∫•t</a>
							</div>
						</div>
						<a class="anh" th:href="@{/gio-hang}"><img
							src="/img/Screenshot_2025-06-19_220342-removebg-preview.png"
							alt=""></a>
					</th:block>
					<th:block th:if="${session.user == null}">
						<a class="ngang" th:href="@{/register}">ƒêƒÉng k√Ω</a> | <a
							class="ngang" th:href="@{/login}">ƒêƒÉng nh·∫≠p</a>
					</th:block>

				</div>
			</div>
		</nav>
	</div>
	
	
	<!-- banner -->
	<div th:replace="~{${content}}"></div>

	<!-- Toast container -->
<div id="toast-container" class="toast-container">
   <div th:each="tb : ${dsThongBaoChuaDoc}" 
        class="toast toast-websocket" 
        th:attr="data-id=${tb.maThongBao}"
        style="background-color: #ffc107; color: #fff; border-radius: 8px; margin-bottom: 8px; padding: 12px 16px;">
        
        <div class="toast-content" style="display: flex; justify-content: space-between; align-items: center;">
        	<a th:href="${tb.url}" onclick="return danhDauVaAn(this)">
                <span th:text="${tb.noiDung}"></span>
        	</a>

            <button class="toast-close" style="background: none; border: none; font-size: 18px; color: #fff; cursor: pointer;" 
                    onclick="danhDauVaAn(this)">
                √ó
            </button>
        </div>
    </div>
</div>
<div id="toast-container1" class="toast-container"></div>

	<!-- Modal x√°c nh·∫≠n -->
	<div id="confirm-modal" class="modal-overlay hidden">
		<div class="modal-content">
			<p id="confirm-message"></p>
			<div class="modal-actions">
				<button id="confirm-yes" class="btn btn-danger">X√°c nh·∫≠n</button>
				<button id="confirm-no" class="btn btn-secondary">H·ªßy</button>
			</div>
		</div>
	</div>


</body>

<footer class="site-footer">
	<div class="footer-container">
		<div class="footer-column">
			<div class="footer-logo">
				<img src="/img/logo_gundam.png" alt="Gundam Shop Footer Logo" /> <span>Gundam
					Shop</span>
			</div>
			<h4>Li√™n h·ªá</h4>
			<p>ƒê·ªãa ch·ªâ: QTSC 9 Building, D. T·ªë K√Ω, T√¢n Ch√°nh Hi·ªáp, Qu·∫≠n 12,
				H·ªì Ch√≠ Minh</p>
			<p>Hotline: xxxx.xxxx.xxx</p>
			<p>Email: abcyz@gmail.com</p>
		</div>

		<div class="footer-column">
			<h4>Ch√≠nh s√°ch</h4>
			<ul>
				<li>Ch√≠nh s√°ch b·∫£o m·∫≠t</li>
				<li>Ch√≠nh s√°ch ƒë·ªïi tr·∫£</li>
				<li>Ch√≠nh s√°ch v·∫≠n chuy·ªÉn</li>
				<li>Quy ƒë·ªãnh s·ª≠ d·ª•ng</li>
			</ul>
		</div>

		<div class="footer-column payment-shipping-column">
			<h4>Thanh to√°n</h4>
			<div class="payment-methods">
				<img src="/img/1.png" alt="Visa" /> <img src="/img/2.png"
					alt="Mastercard" /> <img src="/img/3.jpg" alt="JCB" /> <img
					src="/img/4.png" alt="Amex" /> <img src="/img/5.png" alt="QR Code" />
			</div>
			<h4>ƒê∆°n v·ªã v·∫≠n chuy·ªÉn</h4>
			<div class="shipping-methods">
				<img src="/img/6.png" alt="SPX Express" /> <img src="/img/7.png"
					alt="Giao Hang Tiet Kiem" /> <img src="/img/8.png"
					alt="J&T Express" /> <img src="/img/9.png" alt="Ninja Van" /> <img
					src="/img/12.png" alt="VNPost" /> <img src="/img/10.jpg"
					alt="Giao Hang Nhanh" /> <img src="/img/11.png" alt="Best Express" />
			</div>
		</div>

		<div class="footer-column map-column">
			<h4>Map</h4>
			<img src="/img/google_map.png" alt="Google Map"
				class="footer-map-image" />
		</div>

		<div class="footer-column final-column">
			<h4>ƒê·ªÅ t√†i</h4>
			<p>Website b√°n h√†ng m√¥ h√¨nh l·∫Øp r√°p</p>
			<h4>Th√†nh vi√™n</h4>
			<ul>
				<li>T·ª´ Ng·ªçc S∆°n</li>
				<li>Tr·∫ßn Ph√∫c Duy Khang</li>
				<li>V√µ Tr∆∞·ªùng Giang</li>
				<li>Nguy·ªÖn Ho√†ng Gia Khang</li>
				<li>Ph·∫°m Minh T√¢n</li>
			</ul>
		</div>
	</div>
	
</footer>

<script>
    function danhDauVaAn(element) {
        const toast = element.closest('.toast');
        const id = toast.getAttribute('data-id');
        const isLink = element.tagName === 'A';
        const url = isLink ? element.getAttribute('href') : null;

        const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute('content');
        const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');

        // G·ª≠i POST ƒë√°nh d·∫•u ƒë√£ ƒë·ªçc
        fetch(`/thong-bao/${id}/da-doc`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                [csrfHeader]: csrfToken
            }
        }).then(res => {
            if (res.ok) {
                toast.remove();
                if (isLink && url) {
                    window.location.href = url; // Chuy·ªÉn h∆∞·ªõng sau khi ƒë√°nh d·∫•u
                }
            } else {
                alert('L·ªói khi ƒë√°nh d·∫•u th√¥ng b√°o ƒë√£ ƒë·ªçc');
            }
        }).catch(err => {
            console.error('L·ªói fetch:', err);
            alert('L·ªói k·∫øt n·ªëi m√°y ch·ªß');
        });

        return false; // NgƒÉn chuy·ªÉn h∆∞·ªõng m·∫∑c ƒë·ªãnh n·∫øu l√† <a>
    }
</script>







<script>
    function updatePadding() {
      const navbar = document.getElementById("navbar");
      const mainNav = document.getElementById("main-nav");
      if (navbar && mainNav) {
        mainNav.style.paddingTop = navbar.offsetHeight + "px";
      }
    }

    window.addEventListener("DOMContentLoaded", updatePadding);
    window.addEventListener("resize", updatePadding);

    let lastScrollY = window.scrollY;
    const navbar = document.getElementById("navbar");

    window.addEventListener("scroll", () => {
      const currentScrollY = window.scrollY;

      if (currentScrollY > lastScrollY) {
        // Cu·ªôn xu·ªëng ‚Üí ·∫©n nav
        navbar.style.transform = "translateY(-100%)";
      } else {
        // Cu·ªôn l√™n ‚Üí hi·ªán nav
        navbar.style.transform = "translateY(0)";
      }

      lastScrollY = currentScrollY;
    });
    
  </script>
<script>
function hienThongBaoHeThong(message, isSuccess = true) {
	const container = document.getElementById('toast-container1');

	const toast = document.createElement('div');
	toast.classList.add('toast');
	toast.style.backgroundColor = isSuccess ? '#28a745' : '#dc3545'; // xanh n·∫øu th√†nh c√¥ng, ƒë·ªè n·∫øu l·ªói
	toast.textContent = message;

	container.appendChild(toast);

	setTimeout(() => {
		toast.remove();
	}, 4000);
}




function hienThongBao(noiDung, maThongBao, url) {
    console.log("Nh·∫≠n th√¥ng b√°o:", noiDung, maThongBao, url);
    const container = document.getElementById('toast-container');

    const toast = document.createElement("div");
    toast.className = "toast toast-websocket";
    toast.style.backgroundColor = "#ffc107";
    toast.style.color = "#fff";
    toast.style.borderRadius = "8px";
    toast.style.marginBottom = "8px";
    toast.style.padding = "12px 16px";

    toast.setAttribute("data-id", maThongBao);
    toast.setAttribute("data-url", url);
    toast.innerHTML = `
        <div class="toast-content" style="display: flex; justify-content: space-between; align-items: center;">
            <span>${noiDung}</span>
            <button class="toast-close" style="background: none; border: none; font-size: 18px; color: #fff; cursor: pointer;">√ó</button>
        </div>
    `;

    toast.querySelector(".toast-close").addEventListener("click", function (e) {
        e.stopPropagation();

        const id = toast.getAttribute("data-id");
        const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute('content');
        const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');

        fetch(`/thong-bao/${id}/da-doc`, {
            method: 'POST',
            headers: {
                [csrfHeader]: csrfToken
            }
        }).then(res => {
            if (res.ok) toast.remove();
            else alert("L·ªói khi ƒë√°nh d·∫•u ƒë√£ ƒë·ªçc!");
        }).catch(err => {
            console.error(err);
            alert("L·ªói k·∫øt n·ªëi m√°y ch·ªß");
        });
    });

    toast.addEventListener("click", () => {
        console.log("Click toast, url =", toast.getAttribute("data-url"));
        const id = toast.getAttribute("data-id");
        const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute('content');
        const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');
        const url = toast.getAttribute('data-url'); // l·∫•y url t·ª´ attribute

        fetch(`/thong-bao/${id}/da-doc`, {
            method: 'POST',
            headers: {
                [csrfHeader]: csrfToken
            }
        }).finally(() => {
            if (url) {
                window.location.href = url;
            }
        });
    });


    container.appendChild(toast);
}






  function showConfirm(message, onConfirm) {
	  const modal = document.getElementById("confirm-modal");
	  const messageEl = document.getElementById("confirm-message");
	  const yesBtn = document.getElementById("confirm-yes");
	  const noBtn = document.getElementById("confirm-no");

	  messageEl.textContent = message;
	  modal.classList.remove("hidden");

	  const close = () => modal.classList.add("hidden");

	  yesBtn.onclick = () => {
	    close();
	    onConfirm();
	  };
	  noBtn.onclick = close;
	}
  
</script>
<!-- Th√™m ƒëo·∫°n n√†y trong TrangCaNhan.html -->
<script th:inline="javascript">
    /*<![CDATA[*/
    let error = /*[[${error}]]*/ null;
    let success = /*[[${success}]]*/ null;
    /*]]>*/
</script>

<script>
    if (error !== null && error !== '') {
        hienThongBaoHeThong(error, false);
    }

    if (success !== null && success !== '') {
        hienThongBaoHeThong(success, true);
    }
</script>





<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
<script th:inline="javascript">
/*<![CDATA[*/
const maTK = /*[[${session.user != null ? session.user.maTK : 0}]]*/ 0;

if (maTK > 0) {
	const socket = new SockJS("/ws");
	const stompClient = Stomp.over(socket);
	stompClient.connect({}, function () {
		stompClient.subscribe("/topic/thong-bao/" + maTK, function (message) {
			const data = JSON.parse(message.body); // üëà parse JSON object
			hienThongBao(data.noiDung, data.maThongBao, data.url); // üëà d√πng ƒë√∫ng d·ªØ li·ªáu
		});
	});
}
/*]]>*/
</script>

<!-- Ionicons: ƒë·ªÉ hi·ªÉn th·ªã icon trong form -->
<script type="module"
	src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
<script nomodule
	src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

</html>