<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Document</title>

<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
<link rel="stylesheet" href="/css/style_QuanLyTaiKhoan.css" />
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

</head>

<body>
	<nav id="navbar">
		<div class="nav-left">
			<div class="logo-wrapper">
				<img src="/img/processed_no_white.png" alt="Logo" />
				<div class="logo-title">Gundam Shop</div>
			</div>
		</div>
		<div class="nav-right">
			<label for="">Tài khoản |</label> 
						<div class="account-container">
							<!-- Avatar có thể click được -->
							<a href="#" class="anh"> <img id="avatar-img"
								th:src="${session.user.avatar}"
								alt="Avatar"
								
								onerror="this.onerror=null; this.src='/img/Screenshot_2025-06-19_220523-removebg-preview.png';">
							</a>

							<!-- Dropdown xuất hiện khi hover toàn khối account-container -->
							<div class="account-dropdown">
								<a href="#">Tài Khoản Của Tôi</a> <a th:href="@{/logout}">Đăng
									Xuất</a>
							</div>
						</div>
		</div>
	</nav>

	<div class="container-admin">
		<div class="taskbar" id="taskbar">
			<a href="#" title="Quản lý sản phẩm"><img class="mo"
				style="width: 30px" src="/img/box.png" alt="" /></a> <a
				href="/html/QuanLyTaiKhoan.html" title="Quản lý tài khoản"><img
				style="width: 23px" src="/img/account.png" alt="" /></a> <a href="#"
				title="Quản lý đơn hàng"><img class="mo" style="width: 26px"
				src="/img/booking.png" alt="" /></a> <a href="#"
				title="Quản lý đánh giá/ bình luận"><img class="mo"
				style="width: 24px" src="/img/review.png" alt="" /></a> <a href="#"
				title="Quản lý banner"><img class="mo" style="width: 20px"
				src="/img/advertisement.png" alt="" /></a> <a href="#"
				title="Quản lý thanh toán"><img class="mo" style="width: 20px"
				src="/img/credit-card.png" alt="" /></a>
		</div>
		<div class="form-admin" id="main-form">
			<div class="form-label" id="main-label">
				<label for="">Quản lý tài khoản</label>
				<div class="tabs">
					<button class="tab-button active" data-tab="khach">Khách
						hàng</button>
					<button class="tab-button" data-tab="nhanvien">Nhân viên</button>
				</div>
				<div class="tab-content tab-khach active">
					<div class="tools">
						<div class="search">
							<div class="search-left">
								<input type="text" placeholder="Từ khóa..."
									onfocus="this.placeholder=''"
									onblur="this.placeholder='Từ khóa...'" />
							</div>
							<div class="search-right">
								<button class="in">
									<img src="/img/search.png" alt="" />
								</button>
							</div>
						</div>
						<button class="add">Thêm mới</button>
					</div>

					<div class="form-table">
						<table class="tlb">
							<thead>
								<tr class="tr">
									<th style="width: 3.5%">ID</th>
									<th
										style="text-align: left; width: 12.01%; padding-left: 20px;">
										Họ và tên</th>
									<th style="width: 9.3%">Tên đăng nhập</th>
									<th style="width: 8.4%">Giới tính</th>
									<th style="width: 9.81%">Ngày sinh</th>
									<th style="width: 8.6%">Số điện thoại</th>
									<th
										style="width: 19.08%; text-align: left; padding-left: 10px;">
										Địa chỉ</th>
									<th style="width: 15.4%; text-align: left; padding-left: 10px">
										Email</th>
									<th style="width: 7.9%">Avatar</th>
									<th style="width: 5%"></th>
								</tr>
							</thead>
						</table>
					</div>
				</div>
				<div class="tab-content tab-nhanvien">
					<div class="tools">
						<div class="search">
							<div class="search-left">
								<input placeholder="Từ khóa..." onfocus="this.placeholder=''"
									onblur="this.placeholder='Từ khóa...'" />
							</div>
							<div class="search-right">
								<button class="in">
									<img src="/img/search.png" alt="" />
								</button>
							</div>
						</div>
						<button class="add">Thêm mới</button>
					</div>
					<div class="form-table">
						<table class="tlb">
							<thead>
								<tr class="tr">
									<th style="width: 3.5%">ID</th>
									<th
										style="text-align: left; width: 12.01%; padding-left: 20px;">
										Họ và tên</th>
									<th style="width: 9.3%">Tên đăng nhập</th>
									<th style="width: 8.4%">Giới tính</th>
									<th style="width: 9.81%">Ngày sinh</th>
									<th style="width: 8.6%">Số điện thoại</th>
									<th
										style="width: 19.08%; text-align: left; padding-left: 10px;">
										Địa chỉ</th>
									<th style="width: 15.4%; text-align: left; padding-left: 10px">
										Email</th>
									<th style="width: 7.9%">Avatar</th>
									<th style="width: 5%"></th>
								</tr>
							</thead>
						</table>
					</div>
				</div>
			</div>
			<div class="form-list" id="main-list">
				<div class="form-table2 tab-khach active">
					<table class="myTable">
						<tbody id="table-body">
							<th:block th:each="tk, iterStat : ${khachhang}">
								<tr>
									<td style="width: 3.5%; text-align: center"
										th:text="${tk.maTK}"></td>

									<td
										style="text-align: left; width: 12.01%; padding: 15px 10px 0 20px"
										th:text="${tk.hoTen}"></td>

									<td
										style="width: 9.3%; text-align: left; padding: 15px 10px 0 10px"
										th:text="${tk.tenDangNhap}"></td>

									<td style="width: 8.4%; text-align: center"
										th:text="${tk.gioiTinh == 1 ? 'Nam' : (tk.gioiTinh == 0 ? 'Nữ' : 'Chưa rõ')}"></td>


									<td style="width: 9.81%; text-align: center"
										th:text="${#temporals.format(tk.ngaySinh, 'dd-MM-yyyy')}"></td>

									<td style="width: 8.6%; text-align: center"
										th:text="${tk.soDT}"></td>

									<td
										style="width: 19.08%; text-align: left; padding: 15px 10px 0 10px"
										th:text="${tk.diaChi}"></td>

									<td
										style="width: 15.4%; text-align: left; padding: 15px 10px 0 10px"
										th:text="${tk.email}"></td>

									<td style="width: 7.9%; text-align: center"><img
										style="width: 70px; display: block; margin: auto; border-radius: 50%;"
										th:src="${tk.avatar}" alt="avatar" /></td>

									<td style="width: 5%;"><img
										style="width: 30px; display: block; margin: auto; cursor: pointer;"
										src="/img/Screenshot_2025-06-24_214212-removebg-preview.png"
										alt="action" id="openPopup"></td>
								</tr>
							</th:block>
						</tbody>
					</table>
				</div>

				<div class="form-table2 tab-nhanvien">
					<table class="myTable">
						<tbody id="table-body2">
									<th:block th:each="tk, iterStat : ${nhanvien}">
								<tr>
									<td style="width: 3.5%; text-align: center"
										th:text="${tk.maTK}"></td>

									<td
										style="text-align: left; width: 12.01%; padding: 15px 10px 0 20px"
										th:text="${tk.hoTen}"></td>

									<td
										style="width: 9.3%; text-align: left; padding: 15px 10px 0 10px"
										th:text="${tk.tenDangNhap}"></td>

									<td style="width: 8.4%; text-align: center"
										th:text="${tk.gioiTinh == 1 ? 'Nam' : (tk.gioiTinh == 0 ? 'Nữ' : 'Chưa rõ')}"></td>


									<td style="width: 9.81%; text-align: center"
										th:text="${#temporals.format(tk.ngaySinh, 'dd-MM-yyyy')}"></td>

									<td style="width: 8.6%; text-align: center"
										th:text="${tk.soDT}"></td>

									<td
										style="width: 19.08%; text-align: left; padding: 15px 10px 0 10px"
										th:text="${tk.diaChi}"></td>

									<td
										style="width: 15.4%; text-align: left; padding: 15px 10px 0 10px"
										th:text="${tk.email}"></td>

									<td style="width: 7.9%; text-align: center"><img
										style="width: 70px; display: block; margin: auto; border-radius: 50%;"
										th:src="${tk.avatar}" alt="avatar" /></td>

									<td style="width: 5%;"><img
										style="width: 30px; display: block; margin: auto; cursor: pointer;"
										src="/img/Screenshot_2025-06-24_214212-removebg-preview.png"
										alt="action" id="openPopup"></td>
								</tr>
							</th:block>
						</tbody>
					</table>
				</div>
			</div>

			<div class="form-enter" id="popupDiv">
				<div class="number">
					<label for="name">ID</label> <input type="text" value="" readonly />
				</div>
				<div class="divide">
					<div class="form-enter-left">
						<div class="row">
							<label style="width: 120px" for="name">Họ tên:</label> <input
								style="width: 220px" type="text" id="name" name="name" />
						</div>
						<div class="row">
							<label style="width: 120px" for="loginname">Tên đăng
								nhập:</label> <input style="width: 220px" type="text" id="loginname"
								name="loginname" />
						</div>
						<div class="row">
							<label style="width: 120px" for="phonenumber">Số điện
								thoại:</label> <input style="width: 220px" type="text" id="phonenumber"
								name="phonenumber" />
						</div>
						<div class="row">
							<label style="width: 120px" for="email">Email:</label> <input
								style="width: 220px" type="text" id="email" name="email" />
						</div>
					</div>
					<div class="form-enter-right">
						<div class="row">
							<label style="width: 90px" for="birthday">Ngày sinh:</label> <input
								style="width: 130px" type="date" id="birthday" name="birthday" />
						</div>
						<div class="row">
							<label for="gender" style="width: 90px">Giới tính:</label>
							<div class="gender">
								<label><input class="skip-enter" type="radio"
									name="gender" value="nam" /> Nam</label> <label><input
									class="skip-enter" type="radio" name="gender" value="nu" /> Nữ</label>
							</div>
						</div>
						<div class="row" style="display: flex; align-items: flex-start">
							<label for="address" style="width: 110px">Địa chỉ:</label>
							<textarea id="address" name="address"
								style="width: 220px; height: 60px; resize: vertical; border: 1px solid #d2d2d2;"></textarea>
						</div>
					</div>
					<div class="form-enter-avatar">
						<img src="/img/Screenshot_2025-06-19_220523-removebg-preview.png"
							alt="" /> <label for="">Avatar</label>
					</div>
				</div>
				<div class="button">
					<button class="blue" type="submit" id="btnSave">Lưu</button>
					<button class="red" type="button" id="btnDelete">Xóa</button>
					<button class="green" type="button">Reset</button>
				</div>
			</div>
			<div class="navigation"></div>
		</div>
	</div>

	<script>
 /* 
      const tbody = document.getElementById("table-body");
      const tbody2 = document.getElementById("table-body2");
      const rowHtml = `
    <tr>
      <td style="width: 3.5%; text-align: center">A02</td>
      <td style="text-align: left; width: 12.01%; padding: 15px 10px 0 20px">Từ Ngọc Sơn</td>
      <td style="width: 9.3%; text-align: left; padding: 15px 10px 0 10px">Kabuto</td>
      <td style="width: 8.4%; text-align: center">Nam</td>
      <td style="width: 9.81%; text-align: center">09-02-2005</td>
      <td style="width: 8.6%; text-align: center">0347419152</td>
      <td style="width: 19.08%; text-align: left; padding: 15px 10px 0 10px">121/21/31, đường Nguyễn Thị Kiêu, phường Thới An, quận 12, TP.HCM</td>
      <td style="width: 15.4% ; text-align: left; padding: 15px 10px 0 10px">ngocson92905@gmail.com</td>
      <td style="width: 7.9% ; text-align: center"><img style="width: 70px; display: block; margin: auto;" src="/img/Screenshot_2025-06-19_220523-removebg-preview.png" alt="" /></td>
      <td style="width: 5%";> <img  style="width: 30px; display: block; margin: auto; cursor: pointer;" src="/img/Screenshot_2025-06-24_214212-removebg-preview.png" alt=""> </td>
    </tr>
  `;
      const rowHtml2 = `
    <tr>
      <td style="width: 3.5%; text-align: center">B01</td>
      <td style="text-align: left; width: 12.01%; padding: 15px 10px 0 20px">Võ Trường Giang</td>
      <td style="width: 9.3%; text-align: left; padding: 15px 10px 0 10px">Badboy</td>
      <td style="width: 8.4%; text-align: center">Nam</td>
      <td style="width: 9.81%; text-align: center"></td>
      <td style="width: 8.6%; text-align: center"></td>
      <td style="width: 19.08%; text-align: left; padding: 15px 10px 0 10px"></td>
      <td style="width: 15.4% ; text-align: left; padding: 15px 10px 0 10px"></td>
      <td style="width: 7.9% ; text-align: center"><img style="width: 70px; display: block; margin: auto;" src="/img/Screenshot_2025-06-19_220523-removebg-preview.png" alt="" /></td>
      <td style="width: 5%";> <img  style="width: 30px; display: block; margin: auto; cursor: pointer;" src="/img/Screenshot_2025-06-24_214212-removebg-preview.png" alt=""> </td>
    </tr>
  `;

      for (let i = 0; i < 25; i++) {
        tbody.insertAdjacentHTML("beforeend", rowHtml);
        tbody2.insertAdjacentHTML("beforeend", rowHtml2);
      }
*/
      /*----------------------------------------------------------------------------------------------------*/
      /*hàm ẩn hiện nav và đẩy xuống/lên các form khi nav ẩn/hiện */
      const navbar = document.getElementById("navbar");
      const taskbar = document.getElementById("taskbar");
      const mainForm = document.getElementById("main-form");
      const mainLabel = document.getElementById("main-label");

      let animFrame;
      function updatePosition(topValue) {
        cancelAnimationFrame(animFrame);
        animFrame = requestAnimationFrame(() => {
          mainForm.style.top = topValue + "px";
        });
      }

      // Cập nhật lần đầu khi trang load
      const navHeight = navbar.offsetHeight;
      updatePosition(navHeight);
      taskbar.style.top = navHeight + "px";
      mainLabel.style.top = navHeight + "px";

      // Scroll mượt và chống khựng
      let lastScrollY_nav = window.scrollY;
      let isTicking = false;

      window.addEventListener("scroll", () => {
        if (!isTicking) {
          requestAnimationFrame(() => {
            handleScroll(); // tất cả xử lý được dồn về đây
            isTicking = false;
          });
          isTicking = true;
        }
      });

      function handleScroll() {
        const currentScrollY = window.scrollY;
        const delta = currentScrollY - lastScrollY_nav;

        if (Math.abs(delta) < 5) return;

        const pageHeight = document.body.scrollHeight;
        const windowHeight = window.innerHeight;
        const isNearBottom = currentScrollY + windowHeight >= pageHeight - 5;

        if (delta > 0 && !isNearBottom) {
          navbar.style.transform = "translateY(-100%)";
          updatePosition(0);
          taskbar.style.top = "0px";
          mainLabel.style.top = "0px";
        } else if (delta < 0 && !isNearBottom) {
          const navHeight = navbar.offsetHeight;
          navbar.style.transform = "translateY(0)";
          updatePosition(navHeight);
          taskbar.style.top = navHeight + "px";
          mainLabel.style.top = navHeight + "px";
        }

        lastScrollY_nav = currentScrollY;
      }

      /*----------------------------------------------------------------------------------------------------*/
      /*hàm xử lý qua lại các tab*/
      const buttons = document.querySelectorAll(".tab-button");

      buttons.forEach((button) => {
        button.addEventListener("click", () => {
          const tabId = button.dataset.tab;
          buttons.forEach((btn) => btn.classList.remove("active"));
          document
            .querySelectorAll(".tab-content, .form-list .form-table2")
            .forEach((el) => {
              el.classList.remove("active");
            });
          button.classList.add("active");
          document.querySelectorAll(".tab-" + tabId).forEach((el) => {
            el.classList.add("active");
          });
          window.scrollTo({ top: 0, behavior: "smooth" });

        });
      });
      /*----------------------------------------------------------------------------------------------------*/
      /*hàm xử lý đồng bộ của th td của 2 table*/
      function syncTableWidths() {
        const headerCols = document.querySelectorAll(".table-header th");
        const bodyRows = document.querySelectorAll(".table-body tr");

        const colWidths = Array.from(headerCols).map(
          (th) => th.getBoundingClientRect().width
        );
        bodyRows.forEach((row) => {
          const tds = row.querySelectorAll("td");
          tds.forEach((td, index) => {
            td.style.width = colWidths[index] + "px";
          });
        });
        headerCols.forEach((th, index) => {
          th.style.width = colWidths[index] + "px";
        });
      }
      /*----------------------------------------------------------------------------------------------------*/
      /*ẩn/hiện form-enter bằng các thao tác*/
      const popupDiv = document.querySelector(".form-enter");
      const table = document.querySelectorAll(".myTable");
      const add = document.querySelectorAll(".add");
      let isPopupVisible = false;
      let lastScrollY_popup = window.scrollY;

      table.forEach((table) => {
        table.addEventListener("click", function (e) {
          if (e.target.id === "openPopup") {
            e.stopPropagation();
            popupDiv.style.display = "block";
            isPopupVisible = true;
          }
        });
      });

      add.forEach((btn) => {
        btn.addEventListener("click", function (e) {
          e.stopPropagation();
          popupDiv.style.display = "block";
          isPopupVisible = true;
        });
      });

      popupDiv.addEventListener("click", function (e) {
        e.stopPropagation();
      });

      document.addEventListener("click", function () {
        if (isPopupVisible) {
          popupDiv.style.display = "none";
          isPopupVisible = false;
        }
      });

      window.addEventListener("scroll", function () {
        const currentScrollY = window.scrollY;
        if (isPopupVisible && currentScrollY !== lastScrollY_popup) {
          popupDiv.style.display = "none";
          isPopupVisible = false;
        }
        lastScrollY_popup = currentScrollY;
      });
      /*----------------------------------------------------------------------------------------------------*/
      /*Hàm xử lý enter*/
      const inputs = document.querySelectorAll(
        ".form-enter input, .form-enter textarea"
      );
      const btnSave = document.getElementById("btnSave");
      const btnDelete = document.getElementById("btnDelete");
      // Chuyển NodeList thành mảng để dễ xử lý chỉ số
      const inputArray = Array.from(inputs);

      inputArray.forEach((input, index) => {
        input.addEventListener("keydown", function (e) {
          if (input.tagName === "TEXTAREA" && e.key === "Enter" && e.shiftKey)
            return;

          if (e.key === "Enter") {
            e.preventDefault();

            // Tìm ô kế tiếp KHÔNG có class "skip-enter"
            let nextIndex = index + 1;
            while (
              nextIndex < inputArray.length &&
              inputArray[nextIndex].classList.contains("skip-enter")
            ) {
              nextIndex++;
            }

            if (nextIndex < inputArray.length) {
              inputArray[nextIndex].focus();
            } else {
              btnSave.click(); // Không còn ô nào → gọi Lưu
            }
          }
        });
      });
      btnSave.addEventListener("click", function () {
        alert("Dữ liệu đã được lưu!");
      });
      btnDelete.addEventListener("click", function () {
        alert("Dữ liệu đã được xóa!");
      });
    </script>
</body>
</html>
